# CRMç³»ç»Ÿåç«¯API

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„CRMï¼ˆå®¢æˆ·å…³ç³»ç®¡ç†ï¼‰ç³»ç»Ÿåç«¯APIï¼ŒåŸºäºNode.jsã€Expressã€TypeScriptã€MongoDBå’ŒRedisæ„å»ºã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ” **ç”¨æˆ·è®¤è¯ä¸æˆæƒ** - JWTä»¤ç‰Œã€è§’è‰²æƒé™ã€ä¼šè¯ç®¡ç†
- ğŸ‘¥ **è”ç³»äººç®¡ç†** - è”ç³»äººä¿¡æ¯ã€åˆ†ç»„ã€æ ‡ç­¾ã€æœç´¢
- ğŸ¢ **å®¢æˆ·ç®¡ç†** - å®¢æˆ·æ¡£æ¡ˆã€äº¤äº’è®°å½•ã€çŠ¶æ€è·Ÿè¸ª
- ğŸ’¼ **é”€å”®æœºä¼šç®¡ç†** - æœºä¼šè·Ÿè¸ªã€é˜¶æ®µç®¡ç†ã€é¢„æµ‹åˆ†æ
- ğŸ“‹ **ä»»åŠ¡ç®¡ç†** - ä»»åŠ¡åˆ†é…ã€è¿›åº¦è·Ÿè¸ªã€æé†’é€šçŸ¥
- ğŸ¤– **AIæ™ºèƒ½åŠ©æ‰‹** - è¯æœ¯ç”Ÿæˆã€å¯¹è¯åˆ†æã€å†…å®¹ä¼˜åŒ–

### æŠ€æœ¯ç‰¹æ€§
- ğŸ“Š **æ•°æ®åˆ†æ** - ç»Ÿè®¡æŠ¥è¡¨ã€è¶‹åŠ¿åˆ†æã€å¯¼å‡ºåŠŸèƒ½
- ğŸ“ **æ–‡ä»¶ç®¡ç†** - æ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ã€é¢„è§ˆ
- ğŸ“§ **é‚®ä»¶æœåŠ¡** - é‚®ä»¶å‘é€ã€æ¨¡æ¿ç®¡ç†ã€é€šçŸ¥ç³»ç»Ÿ
- ğŸ”„ **ç¼“å­˜æœºåˆ¶** - Redisç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€æ€§èƒ½ä¼˜åŒ–
- ğŸ›¡ï¸ **å®‰å…¨é˜²æŠ¤** - é€Ÿç‡é™åˆ¶ã€æ•°æ®éªŒè¯ã€é”™è¯¯å¤„ç†
- ğŸ“ **æ—¥å¿—ç³»ç»Ÿ** - ç»“æ„åŒ–æ—¥å¿—ã€é”™è¯¯è¿½è¸ªã€æ€§èƒ½ç›‘æ§

## æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express.js
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: MongoDB
- **ç¼“å­˜**: Redis
- **è®¤è¯**: JWT
- **æ–‡ä»¶ä¸Šä¼ **: Multer
- **é‚®ä»¶æœåŠ¡**: Nodemailer
- **æ—¥å¿—**: Winston
- **éªŒè¯**: Express Validator
- **å®‰å…¨**: Helmet, CORS, Rate Limiting

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 8.0.0
- MongoDB >= 5.0
- Redis >= 6.0

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd crm-backend

# å®‰è£…ä¾èµ–
npm install
```

### ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

### å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm run build
npm start
```

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.ts  # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ redis.ts     # Redisé…ç½®
â”‚   â”œâ”€â”€ email.ts     # é‚®ä»¶é…ç½®
â”‚   â””â”€â”€ storage.ts   # æ–‡ä»¶å­˜å‚¨é…ç½®
â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ authController.ts
â”‚   â”œâ”€â”€ contactController.ts
â”‚   â”œâ”€â”€ customerController.ts
â”‚   â”œâ”€â”€ opportunityController.ts
â”‚   â”œâ”€â”€ taskController.ts
â”‚   â””â”€â”€ aiController.ts
â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.ts      # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ validate.ts  # éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ rateLimiter.ts # é™æµä¸­é—´ä»¶
â”‚   â””â”€â”€ errorHandler.ts # é”™è¯¯å¤„ç†
â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ User.ts
â”‚   â”œâ”€â”€ Contact.ts
â”‚   â”œâ”€â”€ Customer.ts
â”‚   â”œâ”€â”€ Opportunity.ts
â”‚   â””â”€â”€ Task.ts
â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”œâ”€â”€ customers.ts
â”‚   â”œâ”€â”€ opportunities.ts
â”‚   â”œâ”€â”€ tasks.ts
â”‚   â”œâ”€â”€ ai.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger.ts    # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ ApiError.ts  # é”™è¯¯ç±»
â”‚   â””â”€â”€ helpers.ts   # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ types/           # ç±»å‹å®šä¹‰
â”œâ”€â”€ app.ts           # åº”ç”¨é…ç½®
â””â”€â”€ server.ts        # æœåŠ¡å™¨å…¥å£
```

## APIæ–‡æ¡£

### è®¤è¯ç›¸å…³

```
POST /api/auth/register     # ç”¨æˆ·æ³¨å†Œ
POST /api/auth/login        # ç”¨æˆ·ç™»å½•
POST /api/auth/logout       # ç”¨æˆ·ç™»å‡º
POST /api/auth/refresh      # åˆ·æ–°ä»¤ç‰Œ
POST /api/auth/forgot-password # å¿˜è®°å¯†ç 
POST /api/auth/reset-password  # é‡ç½®å¯†ç 
GET  /api/auth/me           # è·å–å½“å‰ç”¨æˆ·
```

### è”ç³»äººç®¡ç†

```
GET    /api/contacts        # è·å–è”ç³»äººåˆ—è¡¨
POST   /api/contacts        # åˆ›å»ºè”ç³»äºº
GET    /api/contacts/:id    # è·å–è”ç³»äººè¯¦æƒ…
PUT    /api/contacts/:id    # æ›´æ–°è”ç³»äºº
DELETE /api/contacts/:id    # åˆ é™¤è”ç³»äºº
```

### å®¢æˆ·ç®¡ç†

```
GET    /api/customers       # è·å–å®¢æˆ·åˆ—è¡¨
POST   /api/customers       # åˆ›å»ºå®¢æˆ·
GET    /api/customers/:id   # è·å–å®¢æˆ·è¯¦æƒ…
PUT    /api/customers/:id   # æ›´æ–°å®¢æˆ·
DELETE /api/customers/:id   # åˆ é™¤å®¢æˆ·
```

### é”€å”®æœºä¼š

```
GET    /api/opportunities   # è·å–æœºä¼šåˆ—è¡¨
POST   /api/opportunities   # åˆ›å»ºæœºä¼š
GET    /api/opportunities/:id # è·å–æœºä¼šè¯¦æƒ…
PUT    /api/opportunities/:id # æ›´æ–°æœºä¼š
DELETE /api/opportunities/:id # åˆ é™¤æœºä¼š
```

### ä»»åŠ¡ç®¡ç†

```
GET    /api/tasks          # è·å–ä»»åŠ¡åˆ—è¡¨
POST   /api/tasks          # åˆ›å»ºä»»åŠ¡
GET    /api/tasks/:id      # è·å–ä»»åŠ¡è¯¦æƒ…
PUT    /api/tasks/:id      # æ›´æ–°ä»»åŠ¡
DELETE /api/tasks/:id      # åˆ é™¤ä»»åŠ¡
```

### AIåŠŸèƒ½

```
POST /api/ai/generate-script    # ç”Ÿæˆé”€å”®è¯æœ¯
POST /api/ai/analyze-conversation # åˆ†æå¯¹è¯
POST /api/ai/generate-email     # ç”Ÿæˆé‚®ä»¶
POST /api/ai/optimize-content   # ä¼˜åŒ–å†…å®¹
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

```bash
# ä»£ç æ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤
npm run lint:fix

# ä»£ç æ ¼å¼åŒ–
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼
npm run test:watch

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### æ„å»ºéƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡
npm start
```

## ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| NODE_ENV | è¿è¡Œç¯å¢ƒ | development |
| PORT | æœåŠ¡ç«¯å£ | 3001 |
| MONGODB_URI | MongoDBè¿æ¥å­—ç¬¦ä¸² | - |
| REDIS_HOST | Redisä¸»æœº | localhost |
| REDIS_PORT | Redisç«¯å£ | 6379 |
| JWT_SECRET | JWTå¯†é’¥ | - |
| SMTP_HOST | é‚®ä»¶æœåŠ¡å™¨ | - |
| UPLOAD_DIR | ä¸Šä¼ ç›®å½• | ./uploads |

## æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
- ä¼šè¯å­˜å‚¨ä¼˜åŒ–
- æŸ¥è¯¢ç»“æœç¼“å­˜

### æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–
- è¿æ¥æ± ç®¡ç†

### å®‰å…¨æªæ–½
- è¯·æ±‚é€Ÿç‡é™åˆ¶
- è¾“å…¥æ•°æ®éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤
- XSSæ”»å‡»é˜²æŠ¤

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—çº§åˆ«
- error: é”™è¯¯ä¿¡æ¯
- warn: è­¦å‘Šä¿¡æ¯
- info: ä¸€èˆ¬ä¿¡æ¯
- debug: è°ƒè¯•ä¿¡æ¯

### ç›‘æ§æŒ‡æ ‡
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡
- æ•°æ®åº“æ€§èƒ½
- å†…å­˜ä½¿ç”¨æƒ…å†µ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MongoDBæœåŠ¡çŠ¶æ€
   - éªŒè¯è¿æ¥å­—ç¬¦ä¸²
   - ç¡®è®¤ç½‘ç»œè¿é€šæ€§

2. **Redisè¿æ¥å¤±è´¥**
   - æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
   - éªŒè¯é…ç½®å‚æ•°
   - ç¡®è®¤ç«¯å£å¼€æ”¾

3. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
   - éªŒè¯æ–‡ä»¶å¤§å°é™åˆ¶
   - ç¡®è®¤ç£ç›˜ç©ºé—´

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ—¥å¿—
DEBUG=crm:* npm run dev

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
NODE_ENV=development npm run dev
```

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: [GitHub Repository]
- é—®é¢˜åé¦ˆ: [Issues]
- é‚®ç®±: support@crm.com

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†é’¥å’Œæ•æ„Ÿé…ç½®ã€‚